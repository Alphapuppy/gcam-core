<?xml version="1.0" encoding="UTF-8"?>
<scenario>
    <!-- This is the default solution configuration file for SGM.  In this configuration file,
         the user-configurable-solver enables specification of solver components and their ordering.
         The available solver components are (See SolverComponentFactory for more info):
             - bisect-all-solver-component
             - log-newton-raphson-solver-component
             - log-newton-raphson-save-deriv-solver-component
             - bisect-one-solver-component
             - bisect-policy-solver-component

         Each solver component has some default parameters for SolutionInfo objects
         as well as max iterations for that component.  They also have the ability to
         parse a logic string to determine which markets (or SolutionInfo) to include.
         In this syntax (See SolutionInfoFilterFactory for more info), the following operators
         are allowed:
             - ( .. ) Paranthesis to group logic as necessary
             - !( .. ) The logical NOT operator
             - || The logical OR operator
             - && The logical AND operator (Note that & alone is an illegal XML character
               so the XML substitue "&amp;" must be used)
         The available operands:
             - all Includes ALL markets
             - solvable If the market has been tagged solvable (see Market::shouldSolve)
             - solvable-nr If the market has been tagged solvable with newton-raphson
                  (see Market::shouldSolveNR)
             - market-type="[type]" If the market is of type [type]
                  (see Market::convert_type_to_string for type names)
             - market-name="[name]" If the Market::getName() equals [name]
             - unsolved If the market is not currently solved to it's tolerance.

         See SolverFactory for available solvers, note that the default solver is 
         BisectionNRSolver and a different solver can be used for each period.
    -->
    <!-- SGM doesn't work well with anything except NR
    -->
    <user-configurable-solver year="2001" fillout="1">
        <!-- <solution-tolerance>0.05</solution-tolerance> -->
        <solution-tolerance>0.001</solution-tolerance>
        <solution-floor>0.0001</solution-floor>
        <calibration-tolerance>0.01</calibration-tolerance>
        <!-- Note the regional derivative calc hack as it is right now does not properly
             account for model calcs so each derivative is counted as 600+ iterations
        -->
        <max-model-calcs>4000</max-model-calcs>
        <log-newton-raphson-solver-component>
            <delta-price>1e-6</delta-price>
            <max-iterations>4</max-iterations>
            <max-price-change>10</max-price-change>
            <solution-info-filter>solvable-nr || (market-type="Tax" &amp;&amp; solvable)</solution-info-filter>
        </log-newton-raphson-solver-component>
        <!-- TODO: maybe a save deriv also a bisect-one on singular unsolved.. but that would require
             more logic than is currently provided
        -->
    </user-configurable-solver>
    <!-- The SolutionInfoParamParser object allows us to specify the following solution algorithm
         parameters with varying granularity.
         The parameters which can be parsed:
             - solution-tolerance
             - solution-floor
             - bracket-interval
             - max-price-change
             - delta-price
         
         These values can be read by "market-type" or "good" for a given "period" and "region".
         Should a region attribute not be provided, it is assumed to be applied for ALL regions for market-type only.
         If multiple parameters could apply to a single market they are resolved with the following
         priority:
             1) Matches good name and region name
             2) Matches market type and region name
             3) Matches market type with the global region
             4) Default values from the Solver/SolverComponent
    -->
    <solution-info-param-parser>
        <!-- applies to all regions since region attribute is not included -->
        <!-- TODO: the SGM "trial" markets are not actually of type Trial-Value, just normal
             markets with names like -market-based-investor.  I could possible list them all
             out by name.
        <max-price-change fillout="1" market-type="Trial-Value" period="1">10</max-price-change>
        -->
    </solution-info-param-parser>
</scenario>
